<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulario de Registro</title>
  </head>
  <body>
    <h1>Formulario</h1>

    <!-- Mostrar errores si existen -->
    <% if (typeof errores !== 'undefined' && errores.length) { %>
      <div id='errores' style="color: red">
        <p>Por favor, corrige los errores:</p>
        <ul>
          <% errores.forEach((error) => { %>
          <li><strong><%= error %></strong></li>
          <% }) %>
        </ul>
      </div>
    <% } %>

    <form action="/form" method="post">

      <!-- Campo: Nombre -->
      <label for="nombre">
        Nombre:
        <input type="text" name="nombre" required value="<%=nombre || ''%>" />
      </label>
      <br />

      <!-- Campo: Edad -->
      <label for="edad">
        Edad:
        <input type="number" name="edad" min="0" required value="<%=edad || ''%>" />
      </label>
      <br />

      <!-- Campo: Ciudad (selector) -->
      <label for="ciudad">
        Ciudad:
        <select name="ciudad" id="ciudad">
          <option value="">-- Selecciona --</option>
          <option value="Madrid" <%= ciudad === 'Madrid' ? 'selected' : '' %>>Madrid</option>
          <option value="Barcelona" <%= ciudad === 'Barcelona' ? 'selected' : '' %>>Barcelona</option>
          <option value="Valencia" <%= ciudad === 'Valencia' ? 'selected' : '' %>>Valencia</option>
        </select>
      </label>
      <br />

      <!-- Campo: Intereses (checkboxes) -->
      <fieldset>
        <label>
          Deportes
          <input type="checkbox" name="intereses" value="deportes" <%= (intereses||[]).includes('deportes') ? 'checked' : '' %> />
        </label>
        <label>
          Peliculas
          <input type="checkbox" name="intereses" value="peliculas" <%= (intereses||[]).includes('peliculas') ? 'checked' : '' %> />
        </label>
        <label>
          Videojuegos
          <input type="checkbox" name="intereses" value="videojuegos" <%= (intereses||[]).includes('videojuegos') ? 'checked' : '' %> />
        </label>
      </fieldset>
      <br />

      <button type="submit">Enviar</button>
    </form>

    <p><a href="/">Volver al inicio</a></p>
  </body>
</html>

<!--
================================================================================
================================================================================

   GUÍA DE SINTAXIS EJS Y FORMULARIOS HTML

   Este archivo es la referencia principal para aprender la sintaxis EJS.
   Los demás archivos .ejs asumen que ya conoces estos conceptos.

================================================================================
================================================================================


================================================================================
1. SINTAXIS EJS - REFERENCIA COMPLETA
================================================================================

EJS = Embedded JavaScript (JavaScript incrustado en HTML)
Se procesa en el SERVIDOR antes de enviar HTML al navegador.

TRES TIPOS DE ETIQUETAS:
------------------------

<%= variable %>
  - Imprime el valor de la variable
  - ESCAPA caracteres especiales (seguro contra XSS)
  - Ejemplo: <%= nombre %> → "Juan"

<% código %>
  - Ejecuta código JavaScript (no imprime nada)
  - Para condicionales, bucles, declaraciones
  - Ejemplo: <% if (edad >= 18) { %> ... <% } %>

<%- html %>
  - Imprime HTML SIN escapar
  - PELIGROSO: puede causar XSS si usas datos de usuario
  - Solo usar con HTML generado por ti, NUNCA con input de usuario


EJEMPLOS PRÁCTICOS:
-------------------

Imprimir variable:
  <p>Hola, <%= nombre %></p>
  → <p>Hola, Juan</p>

Condicional:
  <% if (edad >= 18) { %>
    <p>Mayor de edad</p>
  <% } else { %>
    <p>Menor de edad</p>
  <% } %>

Bucle:
  <ul>
    <% items.forEach((item) => { %>
      <li><%= item %></li>
    <% }) %>
  </ul>

Operador ternario (inline):
  <p class="<%= activo ? 'verde' : 'rojo' %>">Estado</p>

Valor por defecto con ||:
  <input value="<%= nombre || '' %>" />


================================================================================
2. FORMULARIOS HTML - ATRIBUTOS CLAVE
================================================================================

<form action="/form" method="post">
  - action: URL a donde se envían los datos
  - method: "get" o "post"
    * GET: datos visibles en URL (para búsquedas)
    * POST: datos en el cuerpo (para formularios)


TIPOS DE INPUT:
---------------

type="text"     → Texto libre
type="number"   → Solo números (con flechas +/-)
type="email"    → Valida formato email
type="password" → Oculta caracteres (•••••)
type="checkbox" → Casillas múltiples
type="radio"    → Opción única entre varias

<select>        → Menú desplegable
<textarea>      → Texto multilínea


ATRIBUTOS DE VALIDACIÓN HTML:
-----------------------------
required        → Campo obligatorio
min="0"         → Valor mínimo (números)
max="100"       → Valor máximo (números)
minlength="2"   → Longitud mínima (texto)
maxlength="50"  → Longitud máxima (texto)
pattern="..."   → Expresión regular


================================================================================
3. VERIFICAR SI UNA VARIABLE EXISTE
================================================================================

En la primera visita (GET /form), no enviamos la variable "errores".
Si intentamos usarla directamente, causaría un error.

SOLUCIÓN:
<% if (typeof errores !== 'undefined' && errores.length) { %>

Desglosando:
- typeof errores !== 'undefined' → ¿existe la variable?
- errores.length → ¿tiene elementos el array?
- && → ambas condiciones deben ser true


================================================================================
4. MANTENER DATOS DESPUÉS DE ERRORES (UX)
================================================================================

Cuando hay errores de validación, el formulario se vuelve a mostrar.
Es muy molesto para el usuario tener que escribir todo de nuevo.

SOLUCIÓN: Rellenar los campos con los valores que ya escribió.

Para inputs de texto:
  value="<%= nombre || '' %>"

  - Si nombre tiene valor → lo muestra
  - Si nombre es undefined → muestra string vacío (evita "undefined")

Para select:
  <option value="Madrid" <%= ciudad === 'Madrid' ? 'selected' : '' %>>

  - Si ciudad === 'Madrid' → añade atributo "selected"
  - Si no → no añade nada (string vacío)

Para checkboxes:
  <%= (intereses||[]).includes('deportes') ? 'checked' : '' %>

  - (intereses||[]) → si intereses es undefined, usa array vacío
  - .includes('deportes') → ¿contiene 'deportes'?
  - Si sí → 'checked', si no → ''


================================================================================
5. COMPORTAMIENTO ESPECIAL DE CHECKBOXES
================================================================================

Los checkboxes tienen un comportamiento peculiar en HTML:
- Si NO se marca ninguno: req.body.intereses es undefined
- Si se marca UNO: req.body.intereses es un string "deportes"
- Si se marcan VARIOS: req.body.intereses es un array ["deportes", "peliculas"]

Por eso en app.js normalizamos SIEMPRE a array:

  let intereses = req.body.intereses || [];
  if (!Array.isArray(intereses)) intereses = [intereses];


================================================================================
6. VALIDACIÓN: CLIENTE VS SERVIDOR
================================================================================

VALIDACIÓN HTML (cliente):
- Atributos como required, min, pattern
- Proporciona feedback instantáneo al usuario
- PUEDE SER DESACTIVADA desde el navegador (F12 → quitar required)

VALIDACIÓN EN SERVIDOR (app.js):
- Se ejecuta en el código del servidor
- NO puede ser desactivada por el usuario
- Es la ÚNICA validación en la que puedes confiar

REGLA DE ORO:
La validación HTML es para UX (experiencia de usuario).
La validación del servidor es para SEGURIDAD.
SIEMPRE valida en el servidor, aunque también valides en HTML.


================================================================================
7. FLUJO DE DATOS DEL FORMULARIO
================================================================================

PRIMERA VISITA (GET /form):
1. Usuario accede a /form
2. app.js renderiza form.ejs con: { nombre: "", edad: "", ... }
3. Formulario aparece vacío, sin errores

ENVÍO CON ERRORES (POST /form):
1. Usuario llena y envía
2. app.js captura datos de req.body
3. Valida y encuentra errores
4. Renderiza form.ejs con: { nombre: "valor", errores: [...] }
5. Formulario muestra errores y mantiene valores previos

ENVÍO EXITOSO (POST /form):
1. Usuario llena y envía
2. app.js captura y valida
3. Todo OK → renderiza resultado.ejs con los datos


================================================================================
PARA MÁS INFORMACIÓN
================================================================================

- Conceptos generales (middlewares, sesiones, métodos HTTP) → app.js
- Archivos estáticos vs dinámicos → public/index.html
-->
